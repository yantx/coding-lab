### Druid è¿æ¥æ± æ ¸å¿ƒç›‘æ§æŒ‡æ ‡è¯´æ˜
**æŒ‡æ ‡åˆ†ç±»** | **æŒ‡æ ‡åç§°** | **æ•°æ®ç±»å‹** | **å«ä¹‰è¯´æ˜**  
---|---|---|---  
**è¿æ¥æ± çŠ¶æ€** | `ActiveCount` | ç¬æ—¶å€¼ | å½“å‰æ­£åœ¨è¢«ä½¿ç”¨çš„æ´»è·ƒè¿æ¥æ•° [1,4](@ref)  
| `PoolingCount` | ç¬æ—¶å€¼ | å½“å‰è¿æ¥æ± ä¸­ç©ºé—²è¿æ¥æ•° [4,5](@ref)  
| `ActivePeak` | å³°å€¼ | å†å²æ´»è·ƒè¿æ¥æ•°çš„æœ€å¤§å€¼ [4,6](@ref)  
| `MaxActive` | é…ç½®å€¼ | è¿æ¥æ± å…è®¸çš„æœ€å¤§æ´»è·ƒè¿æ¥æ•° [1,3](@ref)  
| `WaitThreadCount` | ç¬æ—¶å€¼ | **å…³é”®é¢„è­¦**ï¼šå½“å‰ç­‰å¾…è·å–è¿æ¥çš„çº¿ç¨‹æ•°ï¼ˆ>0 è¡¨ç¤ºè¿æ¥ä¸è¶³ï¼‰[4,5](@ref)  
| `NotEmptyWaitCount` | ğŸ“Š ç´¯è®¡å€¼ | å› è¿æ¥ä¸è¶³å¯¼è‡´è¯·æ±‚é˜»å¡çš„æ€»æ¬¡æ•° [5,6](@ref)  
**SQL æ‰§è¡Œ** | `ExecuteCount` | ğŸ“Š ç´¯è®¡å€¼ | SQL è¯­å¥æ€»æ‰§è¡Œæ¬¡æ•° [1,4](@ref)  
| `SlowQueries` | ğŸ“Š ç´¯è®¡å€¼ | æ‰§è¡Œæ—¶é—´è¶…è¿‡é˜ˆå€¼çš„æ…¢æŸ¥è¯¢æ•°é‡ï¼ˆéœ€é…ç½® `slow-sql-millis`ï¼‰[1,6](@ref)  
| `ConnectionHoldTimeHistogram` | åˆ†å¸ƒç›´æ–¹å›¾ | è¿æ¥æŒæœ‰æ—¶é—´åˆ†å¸ƒï¼ˆåŒºé—´ï¼š0-1ms, 1-10ms, 10-100ms, ...ï¼‰[5,6](@ref)  
| `PSCacheHitCount` | ğŸ“Š ç´¯è®¡å€¼ | PreparedStatement ç¼“å­˜å‘½ä¸­æ¬¡æ•° [4,6](@ref)  
**äº‹åŠ¡ä¸é”™è¯¯** | `TransactionHistogram` | åˆ†å¸ƒç›´æ–¹å›¾ | äº‹åŠ¡æ‰§è¡Œæ—¶é—´åˆ†å¸ƒï¼ˆåŒºé—´ï¼š0-10ms, 10-100ms, ...ï¼‰[5,6](@ref)  
| `ErrorCount` | ğŸ“Š ç´¯è®¡å€¼ | SQL æ‰§è¡Œé”™è¯¯æ€»æ•° [1,3](@ref)  
| `PhysicalConnectErrorCount` | ğŸ“Š ç´¯è®¡å€¼ | ç‰©ç†è¿æ¥å»ºç«‹å¤±è´¥æ¬¡æ•°ï¼ˆç½‘ç»œ/æƒé™é—®é¢˜ï¼‰[4,6](@ref)  
**èµ„æºä¸æ€§èƒ½** | `BlobOpenCount`/`ClobOpenCount` | ğŸ“Š ç´¯è®¡å€¼ | å¤§å¯¹è±¡ï¼ˆBlob/Clobï¼‰æ‰“å¼€æ¬¡æ•° [4,6](@ref)  
| `KeepAliveCheckCount` | ğŸ“Š ç´¯è®¡å€¼ | ç©ºé—²è¿æ¥ä¿æ´»æ£€æµ‹æ¬¡æ•° [4](@ref)  
| `RecycleErrorCount` | ğŸ“Š ç´¯è®¡å€¼ | è¿æ¥å›æ”¶æ—¶å‘ç”Ÿçš„é”™è¯¯æ•° [4](@ref)  

### å…³é”®ç›‘æ§åœºæ™¯å»ºè®®
1. **è¿æ¥æ± è¿‡è½½é¢„è­¦**
    - å½“ `WaitThreadCount > 0` æˆ– `NotEmptyWaitCount` çªå¢æ—¶ï¼Œéœ€æ£€æŸ¥ `MaxActive` æ˜¯å¦è¿‡å°æˆ–å­˜åœ¨è¿æ¥æ³„æ¼ [3,5](@ref)ã€‚
      - ç¤ºä¾‹é…ç½®ï¼š
          ```yaml
          metrics:
              - name: WaitThreadCount
              threshold: 0
              alert: "è¿æ¥æ± è¿‡è½½ï¼šç­‰å¾…çº¿ç¨‹æ•° > 0"
          druid:
            max-active: 50 # æ ¹æ®æ•°æ®åº“è´Ÿè½½åŠ¨æ€è°ƒæ•´
            max-wait: 2000 # è¿æ¥è·å–æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        ```
        
2. **æ…¢æŸ¥è¯¢ç›‘æ§**
    2. **æ…¢ SQL ä¼˜åŒ–**
- å¯ç”¨æ…¢ SQL æ—¥å¿—ï¼ˆ`slow-sql-millis: 2000`ï¼‰ï¼Œç»“åˆ `SlowQueries` å®šä½éœ€ä¼˜åŒ–çš„ SQL [6](@ref)ã€‚
- é€šè¿‡ `ConnectionHoldTimeHistogram` åˆ†æè¿æ¥å ç”¨æ—¶é—´åˆ†å¸ƒï¼Œè¯†åˆ«é•¿æ—¶é—´æŒæœ‰è¿æ¥çš„é—®é¢˜ [5](@ref)ã€‚

3. **è¿æ¥æ³„æ¼æ£€æµ‹**
- å¼€å¯ `removeAbandoned: true` å’Œ `logAbandoned: true`ï¼Œè‡ªåŠ¨å›æ”¶è¶…æ—¶æœªå½’è¿˜çš„è¿æ¥å¹¶è®°å½•å †æ ˆ [4](@ref)ã€‚
- ç›‘æ§ `LogicConnectCount` ä¸ `LogicCloseCount` å·®å€¼ï¼Œè‹¥æŒç»­å¢é•¿å¯èƒ½å­˜åœ¨æ³„æ¼ [4](@ref)ã€‚

> ğŸ’¡ **æ•°æ®æ¥æºè¯´æ˜**ï¼š
> - **ç¬æ—¶å€¼**ï¼šç»Ÿè®¡æ—¶åˆ»çš„å®æ—¶å¿«ç…§ï¼ˆå¦‚ `ActiveCount`ï¼‰ã€‚
> - **ç´¯è®¡å€¼**ï¼šè‡ªåº”ç”¨å¯åŠ¨ä»¥æ¥çš„ç´¯è®¡æ€»é‡ï¼ˆå¦‚ `ExecuteCount`ï¼‰ã€‚
> - **å³°å€¼**ï¼šå†å²è¿è¡Œè¿‡ç¨‹ä¸­çš„æœ€å¤§å€¼ï¼ˆå¦‚ `ActivePeak`ï¼‰ã€‚  
    > å®Œæ•´å‚æ•°è§ [Druid å®˜æ–¹æ–‡æ¡£](https://github.com/alibaba/druid/wiki) [4,6](@ref)ã€‚
